# シェルスクリプトコーディングスタイルガイド

このドキュメントは、このプロジェクトにおけるシェルスクリプト（Bash）のコーディング基準を概説します。これらのガイドラインに従うことで、一貫性、可読性、保守性を確保します。

## 1. スクリプトヘッダーと設定

- **シェバン**: すべてのスクリプトは `#!/bin/bash` で始める必要があります。
- **エラーハンドリング**: スクリプトの冒頭で `set -euo pipefail`
  を使用してください。
  - `set -e`: コマンドが非ゼロステータスで終了した場合、直ちにスクリプトを終了します。
  - `set -u`: 未設定の変数を展開しようとした場合にエラーとします。
  - `set -o pipefail`: パイプラインの戻り値は、非ゼロステータスで終了した最後のコマンドのステータスになります。非ゼロステータスで終了したコマンドがない場合はゼロになります。

```bash
#!/bin/bash
set -euo pipefail
```

## 2. 変数

- **クォーティング**: 単語の分割やグロブ展開の問題を防ぐため、変数置換は常にダブルクォートで囲んでください (`"${variable}"`)。
- **波括弧**: 変数名を明確に区切るために波括弧を使用してください (例:
  `"${variable}_suffix"`)。
- **命名規則**:
  - グローバル定数と環境変数は `UPPER_SNAKE_CASE` にしてください。
  - ローカル変数は `lower_snake_case` にしてください。
- **スコープ**: グローバルスコープを汚染しないように、関数内のローカル変数は
  `local` キーワードで宣言してください。

```bash
readonly GLOBAL_CONSTANT="値"

function my_func() {
  local my_variable="こんにちは"
  echo "${my_variable}, ${GLOBAL_CONSTANT}"
}
```

## 3. 関数

- **構造**: スクリプトのエントリーポイントとして `main` 関数を使用してください。
- **命名規則**: 関数名は `lower_snake_case` にしてください。
- **定義**: 明確にするために `function` キーワードを使用してください。
- **引数処理**: 引数は専用の関数（例: `parse_args`）で処理してください。

```bash
function main() {
  # スクリプトのロジックをここに記述
}

# すべてのスクリプト引数を渡してmainを呼び出す
main "$@"
```

## 4. 条件分岐とループ

- **テスト**: テストには `[[ ... ]]` を `[ ... ]`
  よりも優先して使用してください。より堅牢で機能が豊富です。
- **可読性**: 複雑な条件やループは、適切なインデントを付けて読みやすくフォーマットしてください。

```bash
# 条件分岐の例
if [[ "${my_var}" == "ある値" ]]; then
  echo "条件が満たされました。"
fi

# ループの例
for i in {1..5}; do
  echo "イテレーション ${i}"
done
```

## 5. コメント

- **ファイルレベル**: ファイルの目的を説明するコメントブロックをファイルの先頭に追加してください。
- **関数レベル**: 複雑な関数には、その振る舞い、入力、出力を説明するコメントを追加してください。

## 6. 可読性

- **インデント**: インデントにはスペースを使用してください（2または4スペースが一般的ですが、一貫性を保ってください）。
- **行の長さ**: 読みやすさを向上させるため、行の長さを適切な長さ（例:
  80〜100文字）に保ってください。
- **言語**: ソースコード内には英語のみを使用し、他の言語を含めないでください。

## 7. リンティング

- **ShellCheck**: シェルスクリプトのリンティングには
  [ShellCheck](https://www.shellcheck.net/)
  を使用します。コミット時に自動的に実行されます。
