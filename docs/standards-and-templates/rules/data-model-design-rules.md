# データモデル設計ルール (Data Model Design Rules)

このドキュメントは、プロジェクト「tas9s10ream」におけるデータモデルの設計およびエンティティ定義に関する具体的なガイドラインとルールを定めます。データモデルの一貫性、品質、保守性を確保することを目的とします。

## 1. 命名規則 (Naming Conventions)

データモデル内の各要素は、以下の命名規則に従うものとします。

- **エンティティ名**: 単数形、パスカルケース (例: `User`, `Task`,
  `RolePermission`)
- **属性名**: スネークケース (例: `user_id`, `full_name`, `created_at`)
- **主キー**: `[エンティティ名]_id` (例: `user_id`, `task_id`, `project_id`)
- **外部キー**: `[参照先エンティティ名]_id` (例: `project_id`,
  `manager_user_id`, `role_id`)
- **中間テーブル**: `[エンティティA名]_[エンティティB名]` (例: `RolePermission`)

## 2. データ型マッピング (Data Type Mapping)

論理データモデルで定義されるデータ型と、物理データモデルで利用されるデータベースのデータ型は、以下の対応を基本とします。

| 論理データ型 | 物理データ型 (例: MySQL) | 備考                                                                          |
| :----------- | :----------------------- | :---------------------------------------------------------------------------- |
| `UUID`       | `CHAR(36)`               | UUIDv4形式を想定                                                              |
| `String`     | `VARCHAR(255)`           | 短い文字列、最大長が明確な場合。必要に応じて長さを調整                        |
| `Text`       | `TEXT`                   | 可変長で長い文字列、最大長が不明確な場合                                      |
| `DateTime`   | `DATETIME`               | 日時情報                                                                      |
| `Date`       | `DATE`                   | 日付情報のみ                                                                  |
| `Boolean`    | `BOOLEAN`                | 真偽値                                                                        |
| `Integer`    | `INT`                    | 整数値                                                                        |
| `Float`      | `FLOAT`                  | 浮動小数点数                                                                  |
| `Decimal`    | `DECIMAL(P,S)`           | 精度が必要な数値 (例: `DECIMAL(10,2)` for 金額)。P: 全桁数, S: 小数点以下桁数 |
| `JSON`       | `JSON`                   | 構造化されたデータ                                                            |

## 3. 共通属性の標準化 (Standardization of Common Attributes)

以下の属性は、特別な理由がない限り、すべてのエンティティに共通して適用されるものとします。

- **主キー**: すべてのエンティティは `[エンティティ名]_id`
  を主キーとし、`CHAR(36)` (UUID) 型とします。
- **タイムスタンプ**:
  - すべてのエンティティに `created_at` (作成日時) と `updated_at` (更新日時) を
    `DATETIME` 型で必須属性として含めます。
  - `created_at` はレコード作成時に自動設定され、`updated_at`
    はレコード更新時に自動更新されるようにデータベースレベルで設定することを推奨します。
- **論理削除**:
  - ユーザー、タスク、プロジェクトなど、物理削除を避けるべきエンティティには
    `is_deleted` (論理削除フラグ) を `BOOLEAN` 型で含め、デフォルト値を `FALSE`
    とします。
  - 論理削除されたレコードの復元や監査の要件がある場合は、`deleted_at`
    (削除日時) 属性の追加も検討します。

## 4. リレーションシップの記述方法 (Relationship Description)

リレーションシップは、以下のガイドラインに従って記述します。

- **カーディナリティ**: 1対1、1対多、多対多を明確に記述します。
- **意味合い**: リレーションシップの役割や意味を具体的に記述します (例: 「作成する」「管理する」「所有する」「構成する」など)。
- **多対多の関係**: 多対多の関係を表現する場合は、必ず中間エンティティを導入し、その定義も行います。

## 5. 制約の定義 (Constraint Definitions)

属性には、以下の制約を明確に定義します。

- **必須属性**: `NOT NULL` 制約を明示します。
- **ユニーク属性**: `UNIQUE` 制約を明示します (例: `email` アドレス)。
- **デフォルト値**: 属性のデフォルト値を明示します。

## 6. ドキュメントの記述スタイル (Documentation Style)

各エンティティ定義ファイル (`docs/deliverables/data-model/entities/*.md`) は、以下の標準的な構成要素と記述順序に従うものとします。

1.  **ID**: エンティティの一意な識別子 (例: `ENT-2025-001`)
2.  **エンティティ名**: エンティティの名称
3.  **概要**: エンティティの目的と役割の簡潔な説明
4.  **属性 (カラム)**: 各属性の名称、データ型、制約、説明をテーブル形式で記述
5.  **リレーションシップ**: 関連する他のエンティティとの関係性
6.  **関連する機能要件**: 関連する機能要件へのリンク
7.  **備考**: 特記事項や補足情報
